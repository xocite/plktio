<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="themes/test/style.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144235537-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-144235537-2');
</script>
<title>Using GPG to master your identity (Part 1) &#8211; AJONLINE</title>
<link rel='dns-prefetch' href='https://s.w.org/' />
<link rel='stylesheet' id='wp-block-library-css'  href='css/dist/block-library/style.min.css?ver=5.2.2' type='text/css' media='all' />
<link rel='https://api.w.org/' href='https://antonyjepson.co.uk/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc.php?rsd" />
<link rel='prev' title='Moving a user cron job to a systemd timer' href='index.html?p=727' />
<link rel='next' title='Git up and going' href='index.html?p=749' />
<meta name="generator" content="WordPress 5.2.2" />
<link rel="canonical" href="index.html?p=741" />
<link rel='shortlink' href='index.html?p=741' />
<link rel="icon" href="uploads/2018/11/favicon.ico" sizes="32x32" />
<link rel="icon" href="uploads/2018/11/favicon.ico" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="uploads/2018/11/favicon.ico" />
<meta name="msapplication-TileImage" content="https://antonyjepson.co.uk/wp-content/uploads/2018/11/favicon.ico" />
</head>
<body>
<div class="gc">
<div class="gi0">
<nav>
<img class="logo" src="uploads/2018/11/favicon.ico" />
<header class="nav">
<a href="https://antonyjepson.co.uk">AJONLINE</a>
</header>
<br /><br /><br />
<li class="page_item page-item-80"><a href="index.html?p=80">About</a></li>
<li class="page_item page-item-596"><a href="index.html?p=596">Contact and Consulting</a></li>
<li class="page_item page-item-668"><a href="index.html?p=668">License</a></li>
<li class="page_item page-item-613"><a href="index.html?p=613">Resume</a></li>
<br />
</nav>
</div> <!-- end gi0 -->
<div class="gi1">

<article>
<header>Using GPG to master your identity (Part 1)</header>
<em>Part of a multi-series post on mastering GPG.</em><br /><em>29 March 2019</em>
<p>I&#8217;ve steered clear of GPG for a while simply because I never implemented a reliable method of storing my keys. Now, with cloud storage, authenticated symmetric encryption, and hardware keys, I believe I can no longer worry about losing my keys. Forgetting the passphrase is a different matter, mind you.</p>
<p>I&#8217;ll be showing you how to create a reliable set of personal GnuPG keys you can use for authentication, authorisation, signatures, and encryption. These keys should stay with you for years to act as your sole source of truth. You do trust yourself, don&#8217;t you? ðŸ™‚</p>
<p>These examples will exist completely separately from your actual key so to speed up the tutorial I will use simple passwords. In your actual keys, well&#8230; you know the drill: use long passphrases that you generate from somewhere and then mutate the results. I usually suggest GRC Perfect Password Generator and some dice.</p>
<p>First, make sure you have GnuPG installed. This software provides a full implementation of the OpenPGP standard. I&#8217;m using version 2.1.18.</p>
<pre><strong># apt install gnupg</strong></pre>
<p>And, we&#8217;ll use our own custom invocation of gpg just for this tutorial.</p>
<pre><strong>$ mkdir $HOME/gpgtutorial
$ cd !$
$ alias gpgh="gpg --homedir=$HOME/gpgtutorial"</strong></pre>
<p>Let&#8217;s jump right into it. We&#8217;ll generate a key right now without a passphrase. This will use the batch functionality so we don&#8217;t have to answer any prompts. The terminal will appear to hang but that&#8217;s because entropy is being generated so wait a while for it to complete. This process took 2 minutes on my machine.</p>
<pre><strong>$ gpgh --batch --pinentry-mode loopback --passphrase '' --quick-generate-key "Antony Jepson (test account) &lt;mail@domain.tld&gt;"</strong>
gpg: keybox '/home/local/gpgtutorial/pubring.kbx' created
[wait 2 minutes]
gpg: /home/local/gpgtutorial/trustdb.gpg: trustdb created
gpg: key 5F3720AC7BE7F124 marked as ultimately trusted
gpg: directory '/home/local/gpgtutorial/openpgp-revocs.d' created
gpg: revocation certificate stored as '/home/local/gpgtutorial/openpgp-revocs.d/B68449CF613EC70C13CC2ABE5F3720AC7BE7F124.rev'</pre>
<p>Let&#8217;s look at the details of this new key and directory structure.</p>
<pre><strong>$ ls</strong>
openpgp-revocs.d private-keys-v1.d pubring.kbx pubring.kbx~ trustdb.gpg</pre>
<p>The openpgp-revocs.d directory contains your revocation certificates. You can use these to say you no longer want a certificate to be valid. The private-keys-v1.d directory contains your private keys. The pubring.kbx keybox file contains all your public keys with the ~ suffix representing the GPG agent&#8217;s backup. The trustdb.gpg file contains your personal web of trust.</p>
<pre><strong>$ gpgh --list-signatures</strong>
gpg: checking the trustdb
gpg: marginals needed: 3 completes needed: 1 trust model: pgp
gpg: depth: 0 valid: 1 signed: 0 trust: 0-, 0q, 0n, 0m, 0f, 1u
gpg: next trustdb check due at 2021-03-27
/home/local/gpgtutorial/pubring.kbx
-----------------------------------
pub rsa3072 2019-03-28 [SC] [expires: 2021-03-27]
B68449CF613EC70C13CC2ABE5F3720AC7BE7F124
uid [ultimate] Antony Jepson (test account) &lt;mail@domain.tld&gt;
sig 3 5F3720AC7BE7F124 2019-03-28 Antony Jepson (test account) &lt;mail@domain.tld&gt;
sub rsa3072 2019-03-28 [E]
sig 5F3720AC7BE7F124 2019-03-28 Antony Jepson (test account) &lt;mail@domain.tld&gt;</pre>
<p>You can see that this key was generated today and expires 1 year and 355 days from now. It consists of a public key that can be used for Signing and generating a Certificate. We have two signatures and the encryption signature has a trust level of 3. Finally, there&#8217;s a sub key that we can use for encryption.</p>
<p>I consider this initial set of keys the master keys. These are the keys you should do your utmost to keep safe. For day-to-day use, we will generate a set of sub keys for each required identity. For example, let&#8217;s generate a sub key to use with Github in order to sign our commits.</p>
<pre><strong>$ gpgh --edit-key "Antony Jepson"</strong>
Secret key is available.

sec rsa3072/5F3720AC7BE7F124
created: 2019-03-28 expires: 2021-03-27 usage: SC
trust: ultimate validity: ultimate
ssb rsa3072/0EDE2324F25F7767
created: 2019-03-28 expires: never usage: E
[ultimate] (1). Antony Jepson (test account) &lt;mail@domain.tld&gt;
<strong>gpg&gt; addkey</strong>
Please select what kind of key you want:
(3) DSA (sign only)
(4) RSA (sign only)
(5) Elgamal (encrypt only)
(6) RSA (encrypt only)
<strong>Your selection? 4</strong>
RSA keys may be between 1024 and 4096 bits long.
<strong>What keysize do you want? (3072)</strong>
Requested keysize is 3072 bits
Please specify how long the key should be valid.
0 = key does not expire
&lt;n&gt; = key expires in n days
&lt;n&gt;w = key expires in n weeks
&lt;n&gt;m = key expires in n months
&lt;n&gt;y = key expires in n years
<strong>Key is valid for? (0) 2y</strong>
Key expires at Sun 28 Mar 2021 09:50:21 BST
<strong>Is this correct? (y/N) y
Really create? (y/N) y</strong>
We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.

[Prompt for passphrase - I left this empty]

sec rsa3072/5F3720AC7BE7F124
created: 2019-03-28 expires: 2021-03-27 usage: SC
trust: ultimate validity: ultimate
ssb rsa3072/0EDE2324F25F7767
created: 2019-03-28 expires: never usage: E
ssb rsa3072/E3114D5381DE17CF
created: 2019-03-29 expires: 2021-03-28 usage: S
[ultimate] (1). Antony Jepson (test account) &lt;mail@domain.tld&gt;
<strong>gpg&gt; quit</strong>
<strong>Save changes? (y/N) y</strong>
<strong>$ gpgh --list-keys --keyid-format long</strong>
/home/local/gpgtutorial/pubring.kbx
-----------------------------------
pub rsa3072/5F3720AC7BE7F124 2019-03-28 [SC] [expires: 2021-03-27]
B68449CF613EC70C13CC2ABE5F3720AC7BE7F124
uid [ultimate] Antony Jepson (test account) &lt;mail@domain.tld&gt;
sub rsa3072/0EDE2324F25F7767 2019-03-28 [E]
sub rsa3072/E3114D5381DE17CF 2019-03-29 [S] [expires: 2021-03-28]</pre>
<p>Now we have a new subkey that can only be used for signing. Git already has a premise for using this key when creating commits.</p>
<pre><strong>$ git config --global user.signingkey E3114D5381DE17CF
$ gpgh --armor --export E3114D5381DE17CF</strong></pre>
<p>Now you can paste the exported key into the relevant Github section in settings to sign your commits both on and off the website.</p>
<p>There&#8217;s a lot more to discover with GnuPG. I&#8217;ll be covering the process of keeping these keys secure in another post.</p>
</article>
</div> <!-- end gi1 -->
<aside class="gi2">
<ul>
<strong>2019</strong><li>7 Jun <a href="index.html?p=778">plkt.io</a></li><li>29 May <a href="index.html?p=774">Using Amplify to launch your first Gatsby app</a></li><li>29 May <a href="index.html?p=768">Immediate broken pipe when connecting via SSH on Gentoo under VMWare Fusion</a></li><li>22 Apr <a href="index.html?p=754">Debugging ebuild failure on Gentoo for lxml</a></li><li>17 Apr <a href="index.html?p=749">Git up and going</a></li><li>29 Mar <a href="index.html?p=741">Using GPG to master your identity (Part 1)</a></li><li>23 Mar <a href="index.html?p=727">Moving a user cron job to a systemd timer</a></li><li>4 Mar <a href="index.html?p=723">Building plkt.io</a></li><li>21 Feb <a href="index.html?p=714">VLAN Primer</a></li><li>6 Feb <a href="index.html?p=707">Creating a disposable dev environment using libvirt</a></li><li>21 Jan <a href="index.html?p=700">Selectively applying changes with Git Stash</a></li><li>9 Jan <a href="index.html?p=690">2019 Goals and Tentatives</a></li><li>4 Jan <a href="index.html?p=680">Fresh Ubuntu 18.04 Install</a></li><li>3 Jan <a href="index.html?p=675">Quickly setting up a local Tiny Tiny RSS instance with Docker</a></li><br /><strong>2018</strong><li>20 Dec <a href="index.html?p=630">Generating smooth sine tone output on iOS</a></li><li>14 Dec <a href="index.html?p=626">Installing Jupyter on macOS Mojave</a></li><li>28 Nov <a href="index.html?p=602">ifconfig Output on macOS Mojave</a></li><li>23 Nov <a href="index.html?p=598">Setting up macOS Mojave</a></li><li>21 Nov <a href="index.html?p=582">Setting up a Docker Pi-hole DNS server for wired and wireless clients</a></li><li>13 May <a href="index.html?p=663">Understanding SHA256 Part 3</a></li><li>12 May <a href="index.html?p=662">Understanding SHA256 Part 2</a></li><li>11 May <a href="index.html?p=661">Understanding SHA256 Part 1</a></li><li>1 Apr <a href="index.html?p=622">Demoscene</a></li><li>1 Jan <a href="index.html?p=624">Running a Bitcoin node</a></li><br /><strong>2016</strong><li>21 Oct <a href="index.html?p=576">Hosting my own blog</a></li><li>4 Aug <a href="index.html?p=544">Creating a video montage with ffmpeg</a></li><br /><strong>2015</strong><li>27 Dec <a href="index.html?p=524">Cloning Logical Volumes on Linux</a></li><li>29 Aug <a href="index.html?p=520">Google public WiFI</a></li><li>29 Aug <a href="index.html?p=508">Arch Linux on Dell M6800</a></li><li>20 Jul <a href="index.html?p=429">iOS 9 Public Beta 1 Changes</a></li><li>19 Apr <a href="index.html?p=492">PDF Minimalist 2015 Calendar for Printing</a></li><br /><strong>2013</strong><li>1 Apr <a href="index.html?p=484">Setting up a git server accessible via ssh</a></li><br /><strong>2012</strong><li>13 Apr <a href="index.html?p=424">Google&#039;s addition of C class stock</a></li><li>1 Mar <a href="index.html?p=405">Backing up your Gmail account using procmail and fetchmail</a></li><li>26 Jan <a href="index.html?p=396">Quickly Attaching USB Devices to VirtualBox Guests using VBoxManage</a></li><br /><strong>2011</strong><li>2 Jun <a href="index.html?p=389">Predictions for iOS 5</a></li><li>10 Feb <a href="index.html?p=385">HP Veer</a></li><br /><strong>2010</strong><li>1 May <a href="index.html?p=378">Getting Started with Symbian Development</a></li><br /><strong>2009</strong><li>2 Nov <a href="index.html?p=373">Printing to a remote printer</a></li><li>10 Sep <a href="index.html?p=369">KDE DPI Issue</a></li><li>22 Aug <a href="index.html?p=365">Sony NWZ-E438F + Video</a></li><li>11 Aug <a href="index.html?p=361">Movies for August 2009</a></li><li>26 Jul <a href="index.html?p=356">Readline</a></li><li>18 Jul <a href="index.html?p=347">Installing Windows XP in VirtualBox</a></li><li>16 Jul <a href="index.html?p=338">Looking Good&#8230;Minimally</a></li><li>3 Jul <a href="index.html?p=335">FreeBSD and Arch Linux</a></li><li>27 Jun <a href="index.html?p=332">Using your Gmail contacts in Mutt</a></li><li>27 Jun <a href="index.html?p=331">Recent Microsoft Developments</a></li><li>25 Jun <a href="index.html?p=318">Budget Intel Gaming Rig ($500)</a></li><li>15 Jun <a href="index.html?p=325">A tired mind cannot comprehend pointer arithmetic</a></li><li>14 Jun <a href="index.html?p=232">Managing gpg keys across multiple computers</a></li><li>1 Jun <a href="index.html?p=313">Elinks advanced URI management</a></li><li>26 May <a href="index.html?p=311">xf86-video-intel-2.6.3 and xorg-server-1.6.1 &#8230; a big fail</a></li><li>24 May <a href="index.html?p=204">Install a GNU/Linux distribution upon a USB Stick</a></li><li>29 Apr <a href="index.html?p=260">Squashing the PITA!</a></li><br /><strong>2008</strong><li>16 Dec <a href="index.html?p=243">Atomicity</a></li><li>16 Dec <a href="index.html?p=247">Changing the default X11 Cursor</a></li><li>9 Dec <a href="index.html?p=238">Using xbindkeys to manage media buttons</a></li><li>8 Dec <a href="index.html?p=242">xf86-video-intel-2.4.3</a></li><li>15 Nov <a href="index.html?p=234">Compiling 2.6.27.6 using the vanilla kernel tree sources</a></li><li>10 Nov <a href="index.html?p=215">MigrationHeuristic</a></li><li>28 Oct <a href="index.html?p=195">Arch Linux and the HP Compaq 2710p</a></li><li>18 Oct <a href="index.html?p=187">Setting up IMAP on Mutt</a></li><li>7 Oct <a href="index.html?p=152">Managing your wireless connection with Wireless Tools for Linux</a></li><li>19 Aug <a href="index.html?p=177">Upgrading to linux-2.6.27-rc3</a></li><li>10 Aug <a href="index.html?p=146">Automatically logout after X is killed</a></li><li>9 Aug <a href="index.html?p=129">Upgrading to catalyst-8.7</a></li><li>8 Aug <a href="index.html?p=123">Upgrading to linux-2.6.27-rc2</a></li><li>4 Aug <a href="index.html?p=106">Upgrading to linux-2.6.27-rc1</a></li><li>1 Aug <a href="index.html?p=86">Customising Email Signatures with Fortune</a></li><li>28 Jul <a href="index.html?p=85">Time Saving Vim Movement Tips</a></li><li>20 Jul <a href="index.html?p=53">Configuring the default prompt (PS1)</a></li><li>15 Jul <a href="index.html?p=45">Adding additional email accounts to your email setup</a></li><li>12 Jul <a href="index.html?p=47">Setting up Mutt</a></li><li>8 Jul <a href="index.html?p=28">Making Diagrams with Xy-pic</a></li><li>7 Jul <a href="index.html?p=26">Changing The Default X Cursor</a></li><li>6 Jul <a href="index.html?p=24">My Desktop &#8211; The Terminal</a></li><li>30 Jun <a href="index.html?p=18">My Desktop &#8211; Music</a></li><li>28 Jun <a href="index.html?p=15">My Desktop &#8211; The Web</a></li><li>26 Jun <a href="index.html?p=8">My Desktop</a></li><li>25 Jun <a href="index.html?p=79">Rationale</a></li></ul> 
</aside>
<footer class="gi3">
<hr />
&copy; 2008 &mdash; 2018 Xocite
</footer>
</div> <!-- end gc -->
</body>
</html>
