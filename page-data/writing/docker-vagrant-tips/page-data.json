{"componentChunkName":"component---src-templates-blog-template-js","path":"/writing/docker-vagrant-tips","result":{"data":{"markdownRemark":{"html":"<p>While I'm slowly migrating my blog over to Wordpress, I've been experimenting with build environments on my Mac and Linux server using a combination of Docker, Vagrant, and Ansible.  Here are some of the tips I've compiled to improve my effectiveness using these tools.</p>\n<h1>Docker</h1>\n<p>Building and running the current context with </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker run --rm `docker build -q .`</code></pre></div>\n<p>Cleaning up all the abandoned containers.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker system prune -a</code></pre></div>\n<p>At some point you'll find that you want to combine multiple builds into a single file.  Luckily Docker now allows multi-stage builds, see <a href=\"https://docs.docker.com/develop/develop-images/multistage-build/\">here</a>.</p>\n<h1>Vagrant</h1>\n<p>Vagrant can work together with Ansible if you add the playbook information in your Vagrantfile, like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  config.vm.provision &quot;ansible&quot; do |ansible|\n    ansible.playbook = &quot;../ansible/site.yml&quot;\n  end</code></pre></div>\n<p>The login information will automatically be copied over so Ansible can run on the virtual machine.  You can also view the config by running <code class=\"language-text\">vagrant ssh-config</code> in the directory of the virtual machine.</p>\n<h1>Ansible</h1>\n<p>When using Ansible, it's best to split up the tasks into roles so you can reuse them later.  A typical directory layout looks like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./site.yml [playbook]: starts the entire environment.\n./hosts [yaml or INI file]: contains the list of hosts.  I prefer to use the YAML format here.\n./roles [directory]\n./roles/common [directory]: common tasks to run on each server\n./roles/common/handlers [directory]: handlers specific to common but can be used anywhere\n./roles/common/tasks [directory]: list of tasks to be executed by this role\n./roles/common/files [directory]: any files that need to be deployed\n./roles/common/templates [directory]: a collection of templates that can be deployed with the common role\n./roles/common/vars [directory]: variables (that aren&#39;t in the defaults) for the common role\n./roles/common/defaults [directory]: default values for the variables for the common role deployment\n./roles/common/meta [directory]: configuration files related to managing ansible</code></pre></div>\n<p>I would spend a bit of time understanding static and dynamic importing <a href=\"https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html\">(more information here)</a> as I think the added flexibility has the potential to cause difficult to debug errors in deployments.</p>\n<p>Roles are then included just like any other task.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> webservers\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">include_role</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> foo_app_instance</code></pre></div>","frontmatter":{"date":"2019-12-11","updated":null,"path":"/writing/docker-vagrant-tips","title":"Some Docker and Vagrant tips"}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}