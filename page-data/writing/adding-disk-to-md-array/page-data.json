{"componentChunkName":"component---src-templates-blog-template-js","path":"/writing/adding-disk-to-md-array","webpackCompilationHash":"390bcefcb0a5d69758ed","result":{"data":{"markdownRemark":{"html":"<p>I run a small <a href=\"https://www.samba.org/\">Samba</a> server at home that I use to store high-fidelity music and photos.  Right now it's based upon a RAID 1 mirrored pair which means I can only withstand a single disk failure before losing my data.</p>\n<p>I recently picked up another <a href=\"https://www.wd.com/products/portable-storage/wd-elements-portable.html\">Western Digital Elements</a> drive and wanted to document how I added it to the array using <a href=\"https://raid.wiki.kernel.org/index.php/Linux_Raid\"><code class=\"language-text\">mdadm</code></a>, software used to manage Linux software RAID arrays.</p>\n<p>First, you'll want to inspect your current configuration carefully  especially if you have an encrypted LUKS setup.  It's easy to forget what in what order you created the array!</p>\n<p>After making sure all drives are plugged in, we'll take a look at our current block devices.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># lsblk</span>\nNAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nloop0                     <span class=\"token number\">7</span>:0    <span class=\"token number\">0</span> <span class=\"token number\">16</span>.2M  <span class=\"token number\">1</span> loop /snap/node/2028\nloop1                     <span class=\"token number\">7</span>:1    <span class=\"token number\">0</span> <span class=\"token number\">88</span>.4M  <span class=\"token number\">0</span> loop /snap/core/6964\nsda                       <span class=\"token number\">8</span>:0    <span class=\"token number\">0</span> <span class=\"token number\">55</span>.9G  <span class=\"token number\">0</span> disk \n├─sda1                    <span class=\"token number\">8</span>:1    <span class=\"token number\">0</span>  512M  <span class=\"token number\">0</span> part /boot/efi\n├─sda2                    <span class=\"token number\">8</span>:2    <span class=\"token number\">0</span>  244M  <span class=\"token number\">0</span> part /boot\n└─sda3                    <span class=\"token number\">8</span>:3    <span class=\"token number\">0</span> <span class=\"token number\">55</span>.2G  <span class=\"token number\">0</span> part \n  ├─vg-root   <span class=\"token number\">254</span>:0    <span class=\"token number\">0</span> <span class=\"token number\">17</span>.7G  <span class=\"token number\">0</span> lvm  /\n  ├─vg-swap   <span class=\"token number\">254</span>:1    <span class=\"token number\">0</span>  <span class=\"token number\">3</span>.9G  <span class=\"token number\">0</span> lvm  <span class=\"token punctuation\">[</span>SWAP<span class=\"token punctuation\">]</span>\n  └─vg-home   <span class=\"token number\">254</span>:2    <span class=\"token number\">0</span> <span class=\"token number\">33</span>.6G  <span class=\"token number\">0</span> lvm  /home\nsdb                       <span class=\"token number\">8</span>:16   <span class=\"token number\">0</span>  <span class=\"token number\">1</span>.8T  <span class=\"token number\">0</span> disk \n├─sdb1                    <span class=\"token number\">8</span>:17   <span class=\"token number\">0</span>  200M  <span class=\"token number\">0</span> part \n├─sdb2                    <span class=\"token number\">8</span>:18   <span class=\"token number\">0</span>  <span class=\"token number\">1</span>.8T  <span class=\"token number\">0</span> part \n└─sdb3                    <span class=\"token number\">8</span>:19   <span class=\"token number\">0</span>  128M  <span class=\"token number\">0</span> part \nsdc                       <span class=\"token number\">8</span>:32   <span class=\"token number\">0</span>  <span class=\"token number\">1</span>.8T  <span class=\"token number\">0</span> disk \n├─sdc1                    <span class=\"token number\">8</span>:33   <span class=\"token number\">0</span>  200M  <span class=\"token number\">0</span> part \n├─sdc2                    <span class=\"token number\">8</span>:34   <span class=\"token number\">0</span>  <span class=\"token number\">1</span>.8T  <span class=\"token number\">0</span> part \n└─sdc3                    <span class=\"token number\">8</span>:35   <span class=\"token number\">0</span>  128M  <span class=\"token number\">0</span> part \nsdd                       <span class=\"token number\">8</span>:48   <span class=\"token number\">0</span>  <span class=\"token number\">1</span>.8T  <span class=\"token number\">0</span> disk \n└─sdd1                    <span class=\"token number\">8</span>:49   <span class=\"token number\">0</span>  <span class=\"token number\">1</span>.8T  <span class=\"token number\">0</span> part </code></pre></div>\n<p>Here you can see my internal hard drive (sda) and my external hard drives (sdb, sdc, and sdd).  <code class=\"language-text\">sdd</code> is the new drive we'll be adding.</p>\n<p>I have a unique setup on my RAID array: I have used the entire disk instead of individual partitions.  It makes it easier to add and remove drives without worrying about matching the partition table.  If you used a specific partition, then recreate that partition table exactly upon the new drive before continuing.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># mdadm --create --verbose /dev/md0 --level=1 --raid-devices=2 /dev/disk/by-id/usb-WD_Elements_EXISTING_DISK_1-0:0 /dev/disk/by-id/usb-WD_Elements_EXISTING_DISK_2-0:0\n[... warnings about being part of an existing array ... ]\nmdadm: array /dev/md0 started.</code></pre></div>\n<p>Next, add the new drive to your RAID array and check /proc/mdstat about the progress.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># mdadm /dev/md0 --add /dev/disk/by-id/usb-WD_Elements_NEW_DISK_1-0:0\nmdadm: added /dev/disk/by-id/usb-WD_Elements_NEW_DISK_1-0:0\n\n# cat /proc/mdstat\nPersonalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] \nmd0 : active raid1 sdd[2](S) sdc[1] sdb[0]\n      1953350656 blocks super 1.2 [2/2] [UU]\n      [&gt;....................]  resync =  0.8% (16522496/1953350656) finish=1121.6min speed=28778K/sec\n      bitmap: 15/15 pages [60KB], 65536KB chunk\n\nunused devices: &lt;none&gt;</code></pre></div>\n<p>From the output, we can see that the resync is beginning to the new disk.  It will take a while -- especially these drives being connected over USB 3.  The advantage of building your LUKS or LVM devices upon the base MD array is that you're now done!</p>","frontmatter":{"date":"2019-06-26","updated":null,"path":"/writing/adding-disk-to-md-array","title":"Adding a new disk to an existing RAID on Linux"}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}