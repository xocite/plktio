{"componentChunkName":"component---src-templates-blog-template-js","path":"/writing/using-serverless-github-hash","webpackCompilationHash":"4a227210207ef0a08b27","result":{"data":{"markdownRemark":{"html":"<!-- main -->\n<table>\n<thead>\n<tr>\n<th>Update history</th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><em>2019-06-13</em></td>\n<td>Add bonus step about using React hooks.</td>\n</tr>\n<tr>\n<td><em>2019-06-13</em></td>\n<td>Use GitHub API token in example.</td>\n</tr>\n</tbody>\n</table>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; border-style: solid; max-width: 650px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAQDBQL/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABg1r8WSOiNOcF4P/EABsQAAIDAQEBAAAAAAAAAAAAAAECAAMRExIi/9oACAEBAAEFAtE5sJrwKPLG7WXoWrUixQgp+q//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAcEAACAgIDAAAAAAAAAAAAAAAAEQECECESMoH/2gAIAQEABj8COs45vwdb6GzY6kTJ/8QAHBABAAMAAgMAAAAAAAAAAAAAAQARITFBUWFx/9oACAEBAAE/IYJ7LvkR5GEIoOWyKdLwubOvWTFmIypPcWMtJ//aAAwDAQACAAMAAAAQ9Ni+/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQAQ/9oACAEDAQE/EGd//8QAFhEBAQEAAAAAAAAAAAAAAAAAEQAQ/9oACAECAQE/ECN//8QAHRABAQEAAgIDAAAAAAAAAAAAAREAITFBcWGRof/aAAgBAQABPxAlOX0XBCZomIwL8miQAIDvvURqQTD08Y6LhBHjLlHmLT91pIhyn1dBysYb/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"macbook goran ivos\"\n        title=\"macbook goran ivos\"\n        src=\"/static/e2ce268f39fa43741529d49aa941a755/a111b/macbook_goran_ivos.jpg\"\n        srcset=\"/static/e2ce268f39fa43741529d49aa941a755/aca85/macbook_goran_ivos.jpg 163w,\n/static/e2ce268f39fa43741529d49aa941a755/0954f/macbook_goran_ivos.jpg 325w,\n/static/e2ce268f39fa43741529d49aa941a755/a111b/macbook_goran_ivos.jpg 650w,\n/static/e2ce268f39fa43741529d49aa941a755/ce471/macbook_goran_ivos.jpg 975w,\n/static/e2ce268f39fa43741529d49aa941a755/bee4e/macbook_goran_ivos.jpg 1300w,\n/static/e2ce268f39fa43741529d49aa941a755/8179c/macbook_goran_ivos.jpg 1600w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n    </span>\nPhoto by <a href=\"https://unsplash.com/@goran_ivos\">Goran Ivos</a> on <a href=\"https://unsplash.com/search/photos/code\">Unsplash</a></p>\n<p>The Git ecosystem is pretty amazing and I'm grateful that it exists.  In this tutorial, I'll be showing you how I added the Git commit hash to the bottom of the website.  This is the first step on enabling versioning history on the site and we'll build the MVP using the Cloudflare Workers \"workers.dev\" free tier.</p>\n<p>This tutorial consists of:</p>\n<ol>\n<li>Generating a personal access token on GitHub</li>\n<li>Writing the serverless Cloudflare worker</li>\n<li>Writing a React component to fetch the Cloudflare worker</li>\n<li><strong>Bonus</strong> Rewriting the React component using React hooks</li>\n</ol>\n<h2>Step 1: Generating a personal access token on GitHub</h2>\n<p>Head on over to <a href=\"https://github.com/settings/tokens\">https://github.com/settings/tokens</a> to create your personal access token.  This will be needed to increase our rate limit from the default access of 60 requests an hour per IP address to the authenticated access which allows 5,000 requests per hour.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; border-style: solid; max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2a1d1ef823f8a3001de759b39848fbb6/12f40/github-personal-access-tokens.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAABmElEQVQ4y+2R207bQBCG902qSqhVORQISYCeVC6Q+sIVQQhE0pI48BC9ahubrB3ba6+9B//MrhVy16TqbUf69M96Z8f/zrKz8y/onnxA7/QT6Ufsd0/w9ugYex3isI/D3jvskrrvnf570lNs73fxYusNXr7aId3G690D7B0co9f/DHY1nGBwPcLF4BJfLwa4uR1iEkwxngSk95jeP/h8PJn69Zj27sYBRt++E3eeZW0QPIBhTTRNg7U1hG2sz9miUPjxWEOq9qDWGpzHmM1ChGGIKIog8hyFVChrg6LSEJWBoLWUEkIIzCKOn1ECUUiwIk/xyBPwOEaaZbDWep1TU56kRIZwHuP3PMMvXiBKCvC0BF8IxEmCOE6wyASSvII2Fsw1cK4cxmjvUtU1yrJEXmpkpUEuW1JaS3JJF6R7Wj+OFpcbnzNjDJRS5KyBMoS2Xkn8t2W4Hy+j0o2nJrRpc3+GYM6ZrCpqpFHRHKWyNCvrtdIrF9qY59ztL2tco1V9s/6V2zfc/NXZag6bgj/ub+Dw7+J/w3+PJ4QlZORRQGG6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github personal access tokens\"\n        title=\"github personal access tokens\"\n        src=\"/static/2a1d1ef823f8a3001de759b39848fbb6/dbb61/github-personal-access-tokens.png\"\n        srcset=\"/static/2a1d1ef823f8a3001de759b39848fbb6/19bd1/github-personal-access-tokens.png 163w,\n/static/2a1d1ef823f8a3001de759b39848fbb6/d3bcb/github-personal-access-tokens.png 325w,\n/static/2a1d1ef823f8a3001de759b39848fbb6/dbb61/github-personal-access-tokens.png 650w,\n/static/2a1d1ef823f8a3001de759b39848fbb6/6b691/github-personal-access-tokens.png 975w,\n/static/2a1d1ef823f8a3001de759b39848fbb6/91670/github-personal-access-tokens.png 1300w,\n/static/2a1d1ef823f8a3001de759b39848fbb6/12f40/github-personal-access-tokens.png 2048w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Once you have signed in, click on <strong>Generate new token</strong> and give it a name.  You won't need to enable any scopes if your repository is publically available on GitHub.  If it isn't, select the <strong>repo:status</strong> scope.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; border-style: solid; max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b63e366179e7192904509b4d81c2ab94/12f40/github-new-personal-access-token.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACFElEQVQ4y61T227TQBD1nyAkBKKURmnTNOUmeEDih6sGoVa0NHUSPgKRNHFix7e1HSde24eZAaMkuPDCSkdndzx7dm423r3/gFbnFY5P3xC/RqPVwcHRCQ4OT/C82Uaz/QL7xI2jDg7bL+n7KfYaLTx49BQPHz8j3sOT/Sb5dnDcfgvj05WJ7sU1zrsfcXbexeXnK5j9IW7NvvBg+BXmYIg+Qez9AXq3Jq6/3BB6wjc9k2zkbw5h4D8vI0gyfHPWSLNSDFrnmM9tfB+NMB7f4W4yFbZtG6vVmrDaQrrBWmsYSRTCcX24ngelFIqigOu6WBDYJntPwXITTJxQMHUUxnYIaxHSnQhRFCGkuyJYFDltMmRZJgaOc247cBYu/CAgUX4sgB9GyHSBLP+JghzLupTr6hBFMUXoIVmmUgJ+SOc5yrIglV+QVZJtG8bmQVyIZ7O51E1RKkmSSCl4HyQaXqzhJ7lA5+Ufor8j3BRdrdcIQ4U1cU6RcY0kdV8hUDGWq0zEiqImwl3BCtwQx3Fkv6TU+ez5vjyyuzazq42Qo7JmM/h+IGdFNeVG2c6CGhWKH09DLnUtt+7XCnLHJzR/yzSVc0DpV4IVM3gSuLY8n/+MkOeqEkyJOcqYGhQqbtQSUZzQGOmtSO8V5DGZWhZG1Gm+ENNlHiNuDP8V962/pmxZM0ynFnIS5Lnk9FiUG8SP7Daxwg/0i1lSRbFmkwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github new personal access token\"\n        title=\"github new personal access token\"\n        src=\"/static/b63e366179e7192904509b4d81c2ab94/dbb61/github-new-personal-access-token.png\"\n        srcset=\"/static/b63e366179e7192904509b4d81c2ab94/19bd1/github-new-personal-access-token.png 163w,\n/static/b63e366179e7192904509b4d81c2ab94/d3bcb/github-new-personal-access-token.png 325w,\n/static/b63e366179e7192904509b4d81c2ab94/dbb61/github-new-personal-access-token.png 650w,\n/static/b63e366179e7192904509b4d81c2ab94/6b691/github-new-personal-access-token.png 975w,\n/static/b63e366179e7192904509b4d81c2ab94/91670/github-new-personal-access-token.png 1300w,\n/static/b63e366179e7192904509b4d81c2ab94/12f40/github-new-personal-access-token.png 2048w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Scroll down and select <strong>Generate token</strong>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; border-style: solid; max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ad0921266dad3744fcaa40ec4b6c1821/12f40/github-created-personal-access-token.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAAB/UlEQVQ4y61S227TQBD1n8ADAgEtvZCkLTfBAxI/jBqEQLQQJ2kfKRcJ1NImNLEdX9fr9a69Pow3aaWWkqgSIx2d2ZnRzPGMrRcvX6Gx+QTNrWfET7HS2MSDhxtYXiestbDWfIQl4jq+3npMvIV7Kw3cuHUXN2/fN3xnaRXLqxtotp7DervTRfvdLrbbb/B6u433H3bQ7fVhd3vEe+jv7Rvf7vbN26Zcx+5h92MHnzq2gclTrtfbh4V/WHWGCnOt1LOCGVsRVzjyJISaBoqiRBj4mLgOvBrOGBlnUFJACo48FxCyQKVLE4+jEDxlkHEMJTJYnMXw/BB+ECBOElJUYRTm+OUJQobjmt0Mhw7HkZPi0BX46RUYhgXGSQWHVZhkAJWASVKoaVJRKCiliAuj8sRP8Xng4+tpiAPiL8PA4GAQ4Nsoxg8nwfdRRH5keBDnOKaufiqv3mEiArjhb/jJGG4wxCQ6NahjE+YhVRG4Cs/BZIjYH0NkDFb9iZfBUo4gjKlJhglN92Jh4EYCEaMd5jmyTJxDiJz2KlGW+rLC2W1NY02Hq+iKmKFCQdALrm5J2h3nHFIV4FIbsHzKQmmjuB4w3e/UZ6KktZRI89LUMONrZOSbT9aa1NTTdWWUnKF+/70SXKypLtZbuKZVC/70K48yH5ibv7bCRfbfG/4Btq9cmznEOUIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github created personal access token\"\n        title=\"github created personal access token\"\n        src=\"/static/ad0921266dad3744fcaa40ec4b6c1821/dbb61/github-created-personal-access-token.png\"\n        srcset=\"/static/ad0921266dad3744fcaa40ec4b6c1821/19bd1/github-created-personal-access-token.png 163w,\n/static/ad0921266dad3744fcaa40ec4b6c1821/d3bcb/github-created-personal-access-token.png 325w,\n/static/ad0921266dad3744fcaa40ec4b6c1821/dbb61/github-created-personal-access-token.png 650w,\n/static/ad0921266dad3744fcaa40ec4b6c1821/6b691/github-created-personal-access-token.png 975w,\n/static/ad0921266dad3744fcaa40ec4b6c1821/91670/github-created-personal-access-token.png 1300w,\n/static/ad0921266dad3744fcaa40ec4b6c1821/12f40/github-created-personal-access-token.png 2048w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Copy this value as we'll need it in the next section.</p>\n<h2>Step 2: Writing the serverless Cloudflare worker</h2>\n<p>In another tab, open up <a href=\"http://workers.dev\">workers.dev</a> and log in.   You'll be presented with a start page.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; border-style: solid; max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f0cfb4b2533bf5933537c4a00b327aef/12f40/cloudflare-workers-homepage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAABuElEQVQ4y51TTW+jMBDlH+eWH9Pf0Osqlz30vtJKlXrYVpW2SgsJGAgE/AXGrzN2SNFuKkV50ovJePz8xmMnujugefoJm78AowJ0C6+PxPZbwhwpTaCv91CHHJJo2hKjPCARVYO6rqC0xqG3qDuNTlnYYYSxl2kHR+MAbSKlNlDGQlMs6ZRBT5RS0mQUGohuHDGOPLrwff7vHKylxUoRNYwxmCjGcc5NQFA0med5CF7C5D3cFMngzff7PYQQqKqK4tM5N/Hefy2kCTfvduJyfoYiZ6Is0XXdeQ2Dc4PDwU2oe4MsS7HdbrHb7cKoyAnjx+M77h6ecf/rb3CrlERJguwwinlW498oOFEpluovioIaVIeSeHc+M8Zr3uL3W4k/WRPLJxGt+fx0aEZLPRjG6DKZrYYd/inPX4gxeLM0/aCKMhSiwodoQjP/O8OlyFKMx+lEhg6uLNyc46dT3sLhtZybN5yukSexWKD/KvlazIt6vjZ5gTTbhe/l3G2C9Dq2okVaHUP57Hiu4CZBSQ+hKONz5W7Pt+FmQb4qZXMMgvz0mOeXcougpisiWhmcMjabDVarFdbrNT4BM3GT71Nh5JYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cloudflare workers homepage\"\n        title=\"cloudflare workers homepage\"\n        src=\"/static/f0cfb4b2533bf5933537c4a00b327aef/dbb61/cloudflare-workers-homepage.png\"\n        srcset=\"/static/f0cfb4b2533bf5933537c4a00b327aef/19bd1/cloudflare-workers-homepage.png 163w,\n/static/f0cfb4b2533bf5933537c4a00b327aef/d3bcb/cloudflare-workers-homepage.png 325w,\n/static/f0cfb4b2533bf5933537c4a00b327aef/dbb61/cloudflare-workers-homepage.png 650w,\n/static/f0cfb4b2533bf5933537c4a00b327aef/6b691/cloudflare-workers-homepage.png 975w,\n/static/f0cfb4b2533bf5933537c4a00b327aef/91670/cloudflare-workers-homepage.png 1300w,\n/static/f0cfb4b2533bf5933537c4a00b327aef/12f40/cloudflare-workers-homepage.png 2048w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Click <strong>Create a Worker</strong>.  Now you will see a very simple (and working!) Cloudflare worker definition.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; border-style: solid; max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/acb4d237243e13716b22de81ab4ebd16/12f40/cloudflare-default-new-worker.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAABw0lEQVQ4y5WTzW7bMBCE9cQ+5uEM9BmKHHJp3CKHxvWPRFGU+CNK5HSWkuG0cB2X8AfS5nq43B1WrlPQL18QzztgDsi+u0uSORh4fcbQHODaIywJpsZsW1TjNEHVZ3SdRmcGpAzwU7g3EpkZJPHjlBAKGVVnPeq2Q6sp2HWw1hZCYLYpIc0zZhJjXBjH65pMTGiMEwY/woYRleVCxN73exwPBxiu21aj7wcMFPY+EF+y16bnXlviG6WgVFti5fCRBwXGVnOaS2aaGx2DhUY1GIaembIE3BcU9xVFIjOK8U+KGJG5koA+GrjUIySPkMNf1crIOZVrp5Tw2SiCJ23wXvPa9QH7008YNsg7h2meWPS5COa8tEnme7DLkXdPFAB6FjWwbpFX9Y7N8ZaiUVQo/KDgYpC0csss+f8y5Nnrl3QbLLPU7zOxRfBfQiuXDB8d1fVd5A/X+yjIDtM2v441jqe6WEcwxtBaA5zzMH2/WI/+rG5ldKndZS0vptXLH+QVOTqgp4gYWkoxrIJCJT9e4fOxrrhfr09RaRrdtI9fWVK+YNe5aRRed9/x7XWHr8/P+PH2drMBYnYZ2+0Wm80GT09P+A1/LJJY7VBEWAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cloudflare default new worker\"\n        title=\"cloudflare default new worker\"\n        src=\"/static/acb4d237243e13716b22de81ab4ebd16/dbb61/cloudflare-default-new-worker.png\"\n        srcset=\"/static/acb4d237243e13716b22de81ab4ebd16/19bd1/cloudflare-default-new-worker.png 163w,\n/static/acb4d237243e13716b22de81ab4ebd16/d3bcb/cloudflare-default-new-worker.png 325w,\n/static/acb4d237243e13716b22de81ab4ebd16/dbb61/cloudflare-default-new-worker.png 650w,\n/static/acb4d237243e13716b22de81ab4ebd16/6b691/cloudflare-default-new-worker.png 975w,\n/static/acb4d237243e13716b22de81ab4ebd16/91670/cloudflare-default-new-worker.png 1300w,\n/static/acb4d237243e13716b22de81ab4ebd16/12f40/cloudflare-default-new-worker.png 2048w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>You can test the template by clicking <strong>Save and deploy</strong> and then issuing <code class=\"language-text\">curl &lt;worker address&gt;</code> in a terminal or opening the address in a web browser.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ curl blue-union-3e08.plktio.workers.dev\n\nhello world</code></pre></div>\n<p>There are a couple things we need to remember before writing a line of code:</p>\n<ul>\n<li>From the GitHub API <a href=\"https://developer.github.com/v3/#user-agent-required\">docs</a>, we'll need to specify a user-agent when querying the API.</li>\n<li>The API in question (also available in the <a href=\"https://developer.github.com/v3/#user-agent-required\">docs</a>) is <code class=\"language-text\">https://api.github.com/repos/xocite/plktio/branches/master</code>.  Replace <code class=\"language-text\">xocite</code> with your username and <code class=\"language-text\">plktio</code> with your repo name.</li>\n</ul>\n<p>We'll write one extra function to fetch the hash from the GitHub server and then update the handle request function to return commit.  </p>\n<p>Let's declare the personal access token and GitHub API endpoint as constants we can access throughout the script.  Remember to replace the endpoint and token with your own.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token constant\">GITHUB_URL_ENDPOINT</span> <span class=\"token operator\">=</span> <span class=\"token string\">'https://api.github.com/repos/xocite/plktio/branches/master'</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">GITHUB_PERSONAL_ACCESS_TOKEN</span> <span class=\"token operator\">=</span> <span class=\"token string\">'65d882ecc9f7d4980409c669cb23a3d068fdb059'</span></code></pre></div>\n<p>Next, we'll write the function to get the GitHub commit hash, keeping in mind that a user agent is required per the GitHub API <a href=\"https://developer.github.com/v3/#user-agent-required\">docs</a>.</p>\n<p>Here's the first version of the function.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchGitHub</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> init <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    method<span class=\"token punctuation\">:</span> <span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span>\n    headers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">'User-Agent'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Cloudflare/workers/xocite'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> init<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> hash <span class=\"token operator\">=</span> result<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">.</span>sha\n\n  <span class=\"token keyword\">return</span> hash\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Next, we'll update the <code class=\"language-text\">handleRequest(request)</code> function to call our fetch function and respond with the commit hash.  Keep in mind that we'll also need to restrict access to the server calling this function -- so make sure you replace plkt.io with your domain name.  If you're running into errors calling this from the terminal, change the domain name to <code class=\"language-text\">&#39;*&#39;</code> until you have the function working.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">request</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  result <span class=\"token operator\">=</span> <span class=\"token function\">fetchGitHub</span><span class=\"token punctuation\">(</span><span class=\"token constant\">GITHUB_URL_ENDPOINT</span><span class=\"token punctuation\">)</span>\n  \n  <span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> result\n  <span class=\"token keyword\">const</span> init <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    status<span class=\"token punctuation\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\n    headers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">'Access-Control-Allow-Origin'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'plkt.io'</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">,</span> init<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To finish the function, we'll add our GitHub authorisation token to the fetch request to increase our rate limit.  Your final function should look something like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token constant\">GITHUB_URL_ENDPOINT</span> <span class=\"token operator\">=</span> <span class=\"token string\">'https://api.github.com/repos/xocite/plktio/branches/master'</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">GITHUB_PERSONAL_ACCESS_TOKEN</span> <span class=\"token operator\">=</span><span class=\"token string\">'65d882ecc9f7d4980409c669cb23a3d068fdb059'</span>\n\n<span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetch'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">request</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  result <span class=\"token operator\">=</span> <span class=\"token function\">fetchGitHub</span><span class=\"token punctuation\">(</span><span class=\"token constant\">GITHUB_URL_ENDPOINT</span><span class=\"token punctuation\">)</span>\n  \n  <span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> result\n  <span class=\"token keyword\">const</span> init <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    status<span class=\"token punctuation\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\n    headers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">'Access-Control-Allow-Origin'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'plkt.io'</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">,</span> init<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchGitHub</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> init <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    method<span class=\"token punctuation\">:</span> <span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span>\n    headers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">'User-Agent'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Cloudflare/workers/xocite'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'Authorization'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"token \"</span> <span class=\"token operator\">+</span> <span class=\"token constant\">GITHUB_PERSONAL_ACCESS_TOKEN</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> init<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> hash <span class=\"token operator\">=</span> result<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">.</span>sha\n\n  <span class=\"token keyword\">return</span> hash</code></pre></div>\n<p>Make sure you see the hash on the right side when you click \"Run\".</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; border-style: solid; max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/33c39e1c5a7e3231dff32130d94f832f/12f40/cloudflare-edited-worker.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAAB/0lEQVQ4y41T2Y7bMBDzF+cxHxegn9Gn3QJtdrFx4kuyrMM6zHKUJkiLbRsBjCJ5RA01nMbpEerrF8TLC5ADNqex+b+jyBxmeNVhGVq46QxLBN0j2wlNTBnT0GOeZ2izYAPu+NcoRGZQIWIuWLkIRKOtRzdOGPUMZSwWH7GECEeUnFFKQeYcY6xY1xWRqHNckVJEiAmzW3l2RSM/87ygHxTMYmGtg+XsnUcIAd4LfM1ezQZKaWhePinF/1dInFwic5NK5mZE11mcTh3eTh9opxHdrJH5TcSXrWCgisvlUgmmaaoYuScXriuzDCQkaROYslIex+M7gzQCs0k5VZRfhBsJU0qfYtt+f+3Gc9M5Bz0MiG5B9g7JWRbco/CNboR/Hnwc8u2GxkXRnsB3hWW2loTrGoTmXu8b4TOohEpn9L1ncQwLQ48xu0dCkX7L8L+EgZI1q9y+vcNrhfQgOTNTIRRriH2ezJDeEj/xcJaDvECIZF24Zn5V8rOj8SQzZqNtJlrD0BqCFsuy3GWL5NO5x/nS0ypjhXSWxIhHjTH0pq6WYpVpbJMxDIbVZqcshkHuoQGvksdJVVNba6srhESMLE9xIxQ0EigGvXaAru21sFPEuLI3qgnt0D0vubYaISQCcb50xcvrN3ycWnz/caTU7tMCSI/LOBwO2O122O/3+AmWfo6t39s6SwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cloudflare edited worker\"\n        title=\"cloudflare edited worker\"\n        src=\"/static/33c39e1c5a7e3231dff32130d94f832f/dbb61/cloudflare-edited-worker.png\"\n        srcset=\"/static/33c39e1c5a7e3231dff32130d94f832f/19bd1/cloudflare-edited-worker.png 163w,\n/static/33c39e1c5a7e3231dff32130d94f832f/d3bcb/cloudflare-edited-worker.png 325w,\n/static/33c39e1c5a7e3231dff32130d94f832f/dbb61/cloudflare-edited-worker.png 650w,\n/static/33c39e1c5a7e3231dff32130d94f832f/6b691/cloudflare-edited-worker.png 975w,\n/static/33c39e1c5a7e3231dff32130d94f832f/91670/cloudflare-edited-worker.png 1300w,\n/static/33c39e1c5a7e3231dff32130d94f832f/12f40/cloudflare-edited-worker.png 2048w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Step 3: Writing a React component to fetch the Cloudflare worker</h2>\n<p>Finally, we'll update the code for the website to call the worker.  For this tutorial, we'll be building this into my existing codebase -- which means we'll be using React components with GatsbyJS.</p>\n<p>Open up VSCode in the folder for your website and create a new component entitled 'git_details.js' under 'src/components'.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; border-style: solid; max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4e0d2cbeb8cdd2c293e67ec3642b8be4/349eb/vscode-add-git-details.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.46478873239437%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB50lEQVQ4y2PYVz2J/cbppWF37hyMeXr3dNTDW8ejHtw8FnX/xtGoe9ePRJ07sR2MTx3ZHHUeSMPEkfHNywdibl46EHxoz2ouhtLsRKk7V3b/+/vt/v9v72////Dy8v9Xj879f/fs8v/3zy//f/v0EhRfBNMgMXT84cWV/w9uHPu+fuVsVYbUpBCZO5d3f/n39eH/n5/u/vn16c7fnx/v/P31+d7f3wQwVM3v/7+e/v/x4c7bDavnqjGkJUVI3zy34ev/7w/+///+6O+/bw//kYj//v/55P/3D7ffb12/QI0hIdpH5vq57V///3j8H6Tg79cH/0nEf0EuBBm4ZR3QwJSEIJmbF3YCDXwENxBIE40xDEyK9Ze5cX4HigspMjAzNULm/vUD1DMwNzNG5sGNQ9QzMCcjekgYeBCYDiGSQPyPRAxJh+/hBsZIP7p17Mv/3y/+A135B5S4gUnoL5gmDv/5//vp/1+f7r7bAkrYidEeMuePLv799c1ZUNb7//vzfTANzFZYE/KfL/fBciD8G8T+BFQH9Pq751e+bFoLzHqmBiJcxWl6gcWZlpE9XXXhE/ubI7o66yL6exsjZk3riJg5pT1i5lQIngXE0ya3Rkzoa4qYAJSfBFQLxOFA9ZE93Q0BpQWpPAD/svqG5TnW1wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"vscode add git details\"\n        title=\"vscode add git details\"\n        src=\"/static/4e0d2cbeb8cdd2c293e67ec3642b8be4/dbb61/vscode-add-git-details.png\"\n        srcset=\"/static/4e0d2cbeb8cdd2c293e67ec3642b8be4/19bd1/vscode-add-git-details.png 163w,\n/static/4e0d2cbeb8cdd2c293e67ec3642b8be4/d3bcb/vscode-add-git-details.png 325w,\n/static/4e0d2cbeb8cdd2c293e67ec3642b8be4/dbb61/vscode-add-git-details.png 650w,\n/static/4e0d2cbeb8cdd2c293e67ec3642b8be4/6b691/vscode-add-git-details.png 975w,\n/static/4e0d2cbeb8cdd2c293e67ec3642b8be4/91670/vscode-add-git-details.png 1300w,\n/static/4e0d2cbeb8cdd2c293e67ec3642b8be4/349eb/vscode-add-git-details.png 2272w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>We'll need to keep the following in mind:</p>\n<ul>\n<li>We're building a React component class that performs network activity, so we'll need to keep the network activity inside the <code class=\"language-text\">componentDidMount()</code> function.  More details on the <a href=\"https://reactjs.org/docs/react-component.html#constructor\">React documentation</a>.</li>\n<li>We don't want the hash to unexpectantly appear on the page so we'll set a default value in the constructor.</li>\n</ul>\n<p>The final class looks something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">GitDetails</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Fetching hash...\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">'https://blue-union-3e08.plktio.workers.dev/'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span> method<span class=\"token punctuation\">:</span> <span class=\"token string\">'GET'</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> GitDetails</code></pre></div>\n<p>Next, we can import that in our layout.js file </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; border-style: solid; max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cd1ba67ce0f2b6e425617ff63fd20ae9/349eb/vscode-modify-layout.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.46478873239437%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC/ElEQVQ4y42T20/TYBTA92ZCfPRJ9uoejS8++B/4YtQQZasjRgUCxgtxLr4ooD6gEyEYNaDxFt4kBIIieHngJiiCXDZ3b9eO24Ct7bp23a09npbBhpnGh19O+7X9fed859Qw3ty5x/29+7TTNWwNuMaIpeAUsUxNE4x/iiA9E8TCzCdiZnKQmJ54Ryz8+EhQ3gmCdI/rz7RIYfQ7R63exZGK0S89ZYabtvr9vvkhNRKehqXgN5A5D+REGhIbHohHnIgLuDUnsKtOPfJ4X8z2Gu2blPvfPj9gqK8+ZfQvfhZlIQQyH8wlYm5F4oKKwFFKIs4oosAoWZFWQA4ralKD2UFbkwUym5ZoyAhkbKD3pclQV20p9872SZJAQjJOKrEYqUY3g2qcC6mSQKupREhVJLokkGTUlEApUoLGygJcb88rk+FC1THjr58fJBkXU3FSTbBBkAUKcrirhpIHM9q5Ll7DdxRIL0OKD3CD/W8ww/MVRs/8MAqxZBSm2ACwnB8iXADWERbvJT6oy9XktmjXBgrkVoFfd3OOliaToebscaN7bkhKiVsZplESjwdhAyWbfAB4jBncTJEYXbIl3b5mdoSxVSdnt102GS7VWoyUewTPkAaR9avcpg/C2DUKu0wjkXUP8FE/JHkfpIVAXrbrGHRhFIXXrl81GRouVhlD3jFJxC5LKBTwDEXMEhsEWufTGHVQlvmHUMvwhv2KJrQaKc+olMaSsTQ1hx+AnCdZKA1HJk/pkrk1F9d8y14Qal3G7FSWpUCMhxDcQCw0okCJDDMr+tj097woFlJYkgcHNYCzx/x19kqgj40mHOx7jU2ps5aH/ZMiZCMAqXBOm36MW8j/RQ6yK9qfwr7XhOfOHDXOfe3OStFZPHgSsjgiWsxgxn8OclarooisGNJEoMphYNdc4kAvlnz40L4yW+3Bk7b6I5ZWR2NlR/tds+N+o7n94W3zs6f3zF2PW8xdT1rMnRg72u6Y21qb9Wcaj/BdpLLV0WR54Gg6YW+o2fsbPZXxhXNY698AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"vscode modify layout\"\n        title=\"vscode modify layout\"\n        src=\"/static/cd1ba67ce0f2b6e425617ff63fd20ae9/dbb61/vscode-modify-layout.png\"\n        srcset=\"/static/cd1ba67ce0f2b6e425617ff63fd20ae9/19bd1/vscode-modify-layout.png 163w,\n/static/cd1ba67ce0f2b6e425617ff63fd20ae9/d3bcb/vscode-modify-layout.png 325w,\n/static/cd1ba67ce0f2b6e425617ff63fd20ae9/dbb61/vscode-modify-layout.png 650w,\n/static/cd1ba67ce0f2b6e425617ff63fd20ae9/6b691/vscode-modify-layout.png 975w,\n/static/cd1ba67ce0f2b6e425617ff63fd20ae9/91670/vscode-modify-layout.png 1300w,\n/static/cd1ba67ce0f2b6e425617ff63fd20ae9/349eb/vscode-modify-layout.png 2272w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Now, running this locally, we can see the result working.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; border-style: solid; max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2724716150dee50537a1b1706cfb0be2/12f40/plktio-git-hash.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAABHklEQVQ4y+1S226EIBTc//+5vjVpmjR1xfulICCK4PRAo8luNsZN+9hJxnNBx8PAZfUrrm8tio8eRltYC9jZwTuPgHVdd97Xj3hx9OH7S4bP1wqST+AcGHoDOzncYxM9wmUhwVEV0LpDlmVomwpVVVLOwFIWe3meI01T6lcxhpoxhiRJ4nrodV33I+hpy1IOkWIQEEJgnmc477AsS6RzLvZCbq3dGXpbHt6JgsHD6spRM46+luhKAd4oiEZDDUSlYIzBGUQPw2M29LdxoegwjQ6jJipLQnafcjPde/+Q+6GEoq7Jt7JBXbQUadKvhQ5nIl8dnkWcUEqJgTxUSkJpSZNp4hg2ceqq3FybY09wc/9OT3jEZ8SiIP4Y/4K/xzcoZJ3fgbyNegAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"plktio git hash\"\n        title=\"plktio git hash\"\n        src=\"/static/2724716150dee50537a1b1706cfb0be2/dbb61/plktio-git-hash.png\"\n        srcset=\"/static/2724716150dee50537a1b1706cfb0be2/19bd1/plktio-git-hash.png 163w,\n/static/2724716150dee50537a1b1706cfb0be2/d3bcb/plktio-git-hash.png 325w,\n/static/2724716150dee50537a1b1706cfb0be2/dbb61/plktio-git-hash.png 650w,\n/static/2724716150dee50537a1b1706cfb0be2/6b691/plktio-git-hash.png 975w,\n/static/2724716150dee50537a1b1706cfb0be2/91670/plktio-git-hash.png 1300w,\n/static/2724716150dee50537a1b1706cfb0be2/12f40/plktio-git-hash.png 2048w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>That's it for including the Git commit hash on your deployment using serverless functions.</p>\n<h2>Step 4: Rewriting the React component using React hooks</h2>\n<p>We can make our Cloudflare worker even simpler by using React hooks.  They allow you to write simple functions instead of using classes.  Additionally, managing the state of the component is easier than using classes.  You can read more about them on the <a href=\"https://reactjs.org/docs/hooks-intro.html\">React blog</a>.</p>\n<p>In our original class, we set the state in the constructor.  With React hooks, we'll set the state in the beginning of the function instead.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">GitDetails</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> initialState <span class=\"token operator\">=</span> <span class=\"token string\">\"Fetching hash...\"</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>result<span class=\"token punctuation\">,</span> setResult<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>initialState<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Next, we'll move the contents of the <code class=\"language-text\">componentDidMount()</code> method into the <code class=\"language-text\">useEffect()</code> method hook.  This new method combines <code class=\"language-text\">componentDidMount()</code>, <code class=\"language-text\">componentDidUpdate()</code>, and <code class=\"language-text\">componentDidUnmount()</code>.  This hooks lets us tell React to run it after we complete the render. </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useState<span class=\"token punctuation\">,</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'https://blue-union-3e08.plktio.workers.dev/'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> method<span class=\"token punctuation\">:</span> <span class=\"token string\">'GET'</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token function\">setResult</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Because useEffect will run after componentDidUpdate -- potentially resulting in multiple fetches -- we will tell it to skip re-rendering the effect if a component value changes.  </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Before</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// After</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Finally, because we're writing a function and not a class we will move the contents of the render call inside the return call.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span>result<span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Great.  Now our final React hook function looks like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> useState<span class=\"token punctuation\">,</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">GitDetails</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> initialState <span class=\"token operator\">=</span> <span class=\"token string\">\"Fetching hash...\"</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>result<span class=\"token punctuation\">,</span> setResult<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>initialState<span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">'https://blue-union-3e08.plktio.workers.dev/'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span> method<span class=\"token punctuation\">:</span> <span class=\"token string\">'GET'</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token function\">setResult</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>result<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> GitDetails</code></pre></div>\n<p>React hooks are easy to use and make it easier to debug your code so I encourage you to use them when writing new code.</p>\n<h2>Recap</h2>\n<p>To recap:</p>\n<ul>\n<li>We retrieved our personal access token from GitHub because authenticated users have an increased rate limit of 5,000 requests an hour.</li>\n<li>We wrote a basic Cloudflare worker that receives a request, contacts GitHub via the API, and responds with a commit hash.</li>\n<li>We wrote a React component class that calls our Cloudflare worker and displays the result in the page.</li>\n<li><strong>Bonus</strong> We rewrote the React component class into a simpler function using React hooks.</li>\n</ul>\n<p>Thank you for reading this tutorial all the way to the end.  I hope it was helpful to understand the basics of connecting serverless functions with your static websites!</p>","frontmatter":{"date":"2019-06-12","updated":"2019-06-13","path":"/writing/using-serverless-github-hash","title":"Showing the commit version on your static site using serverless functions"}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}